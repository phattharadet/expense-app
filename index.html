<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>

<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:system-ui;background:#f5f7fa;margin:0;}
.dark{background:#121212;color:white;}
.container{max-width:520px;margin:auto;padding:15px;}
.card{background:white;padding:15px;border-radius:16px;margin-bottom:15px;}
.dark .card{background:#1e1e1e;}
.add-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;font-size:30px;background:#4CAF50;color:white;}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
<canvas id="monthChart"></canvas>
</div>

<div class="card">
<button onclick="backup()">‚òÅÔ∏è Backup</button>
<input type="file" onchange="restore(event)">
<button onclick="notifyMe()">üîî ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
<button onclick="toggleDark()">üåô Dark</button>
</div>

</div>

<button class="add-btn" onclick="addDummy()">+</button>

<script>
let data=JSON.parse(localStorage.getItem("data"))||[];

function save(){localStorage.setItem("data",JSON.stringify(data));}

// üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
function drawMonthChart(){

let income=[0,0,0,0,0,0,0,0,0,0,0,0];
let expense=[0,0,0,0,0,0,0,0,0,0,0,0];

data.forEach(d=>{
let m=new Date(d.date).getMonth();
if(d.type=="income") income[m]+=d.amount;
else expense[m]+=d.amount;
});

new Chart(monthChart,{
type:'line',
data:{
labels:["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."],
datasets:[
{label:"‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö",data:income},
{label:"‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢",data:expense}
]
}
});
}

// ‚òÅÔ∏è Backup
function backup(){
let blob=new Blob([JSON.stringify(data)]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="backup.json";
a.click();
}

// ‚ôªÔ∏è Restore
function restore(e){
let file=e.target.files[0];
let reader=new FileReader();
reader.onload=function(){
data=JSON.parse(reader.result);
save();
location.reload();
}
reader.readAsText(file);
}

// üåô Dark mode
if(localStorage.getItem("dark")) document.body.classList.add("dark");

function toggleDark(){
document.body.classList.toggle("dark");
localStorage.setItem("dark",document.body.classList.contains("dark"));
}

// üîî Notification
function notifyMe(){
Notification.requestPermission().then(p=>{
if(p==="granted"){
new Notification("‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ üí∏");
}
});
}

// ‚ûï dummy data test
function addDummy(){
data.push({
date:new Date(),
type:"expense",
amount:Math.floor(Math.random()*500)
});
save();
location.reload();
}

// üì≤ PWA
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}

drawMonthChart();
</script>

</body>
</html>
